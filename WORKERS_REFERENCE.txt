EDM LIBRARY WIZARD - WORKERS MODULE REFERENCE
==============================================

Module: edm_wizard/workers/threads.py
Total Lines: 827

WORKER CLASS LOCATIONS
======================

1. Module Header & Imports
   Lines 1-48
   - Docstring describing all 7 worker classes
   - Standard library imports
   - Third-party imports (pandas, sqlalchemy, PyQt5)
   - Optional imports with availability flags (anthropic, fuzzywuzzy, requests)
   - Relative imports (clean_sheet_name from utils.data_processing)

2. AccessExportThread
   Lines 50-97 (48 lines)
   Class: Access database export to Excel
   Methods:
   - __init__(mdb_file, output_file)
   - run()
   Signals: progress, finished, error

3. SQLiteExportThread
   Lines 98-151 (54 lines)
   Class: SQLite database export to Excel
   Methods:
   - __init__(sqlite_file, output_file)
   - run()
   Signals: progress, finished, error

4. SheetDetectionWorker
   Lines 152-304 (153 lines)
   Class: Single sheet AI column detection
   Methods:
   - __init__(api_key, sheet_name, dataframe, model, max_retries)
   - run() [with exponential backoff retry logic]
   Signals: finished, error

5. AIDetectionThread
   Lines 305-424 (120 lines)
   Class: Coordinator for parallel AI detection across sheets
   Methods:
   - __init__(api_key, dataframes, model)
   - run() [with sequential processing and rate limit protection]
   - on_sheet_completed(sheet_name, mapping)
   - on_sheet_error(sheet_name, error_msg)
   Signals: progress, finished, error

6. PartialMatchAIThread
   Lines 425-527 (103 lines)
   Class: AI suggestions for partial matches
   Methods:
   - __init__(api_key, parts_needing_review, combined_data)
   - run()
   - get_description_for_part(part_number, mfg)
   Signals: progress, part_analyzed, finished, error

7. ManufacturerNormalizationAIThread
   Lines 528-685 (158 lines)
   Class: AI manufacturer name normalization
   Methods:
   - __init__(api_key, all_manufacturers, supplyframe_manufacturers)
   - run() [with complex validation logic]
   Signals: progress, finished, error

8. PASSearchThread
   Lines 686-827 (142 lines)
   Class: Parallel PAS API batch search
   Methods:
   - __init__(pas_client, parts_data, max_workers)
   - search_single_part(idx, part, total) [with retry logic]
   - run() [with ThreadPoolExecutor]
   Signals: progress, result_ready, finished, error

PACKAGE STRUCTURE
=================

edm_wizard/workers/__init__.py (30 lines)
- Module docstring
- Imports all 7 worker classes from threads module
- __all__ list exporting public API

edm_wizard/workers/threads.py (827 lines)
- All worker class implementations
- Organized imports at top
- Comprehensive docstrings
- Signal definitions
- Complete method implementations

SIGNAL DEFINITIONS BY CLASS
===========================

AccessExportThread:
  progress = pyqtSignal(str)
  finished = pyqtSignal(str, object)
  error = pyqtSignal(str)

SQLiteExportThread:
  progress = pyqtSignal(str)
  finished = pyqtSignal(str, object)
  error = pyqtSignal(str)

SheetDetectionWorker:
  finished = pyqtSignal(str, dict)
  error = pyqtSignal(str, str)

AIDetectionThread:
  progress = pyqtSignal(str, int, int)
  finished = pyqtSignal(dict)
  error = pyqtSignal(str)

PartialMatchAIThread:
  progress = pyqtSignal(str, int, int)
  part_analyzed = pyqtSignal(int, dict)
  finished = pyqtSignal(dict)
  error = pyqtSignal(str)

ManufacturerNormalizationAIThread:
  progress = pyqtSignal(str)
  finished = pyqtSignal(dict, dict)
  error = pyqtSignal(str)

PASSearchThread:
  progress = pyqtSignal(str, int, int)
  result_ready = pyqtSignal(dict)
  finished = pyqtSignal(list)
  error = pyqtSignal(str)

IMPORT PATH DOCUMENTATION
=========================

Old (from edm_wizard.py):
  from edm_wizard import AccessExportThread

New (from workers module):
  from edm_wizard.workers import AccessExportThread
  from edm_wizard.workers import (
      AccessExportThread,
      SQLiteExportThread,
      SheetDetectionWorker,
      AIDetectionThread,
      PartialMatchAIThread,
      ManufacturerNormalizationAIThread,
      PASSearchThread
  )

DEPENDENCIES SUMMARY
====================

Required (always imported):
- json
- time
- threading
- datetime (datetime, timedelta)
- concurrent.futures (ThreadPoolExecutor, as_completed)
- pandas (pd)
- sqlalchemy (sa)
- urllib.parse
- sqlalchemy (inspect)
- PyQt5.QtCore (QThread, pyqtSignal)

Optional (with availability flags):
- anthropic.Anthropic (ANTHROPIC_AVAILABLE)
- fuzzywuzzy (fuzz, process) (FUZZYWUZZY_AVAILABLE)
- requests (REQUESTS_AVAILABLE)

Relative Imports:
- ..utils.data_processing (clean_sheet_name)

KEY FEATURES BY CLASS
=====================

AccessExportThread:
✓ Connects to .mdb/.accdb files
✓ Extracts all tables
✓ Cleans sheet names (31 char limit)
✓ Exports to Excel with progress

SQLiteExportThread:
✓ Handles .db/.sqlite/.sqlite3
✓ Auto-detects table structure
✓ Filters system tables
✓ Converts to Excel

SheetDetectionWorker:
✓ Analyzes 10-50 rows per sheet
✓ AI-powered column detection
✓ Exponential backoff (5 retries)
✓ Rate limit handling (429 errors)
✓ Confidence scoring

AIDetectionThread:
✓ Creates worker per sheet
✓ Sequential processing (avoid API limits)
✓ 12-second delays between requests
✓ Error tracking & reporting
✓ Collects all results

PartialMatchAIThread:
✓ Processes multi-match parts
✓ Extracts descriptions
✓ Per-part confidence scoring
✓ Real-time progress updates
✓ Handles AI failures gracefully

ManufacturerNormalizationAIThread:
✓ Comprehensive validation rules
✓ Prevents reverse mappings
✓ Filters exact matches
✓ Ensures canonical sources
✓ Provides reasoning for each mapping

PASSearchThread:
✓ ThreadPoolExecutor (parallel)
✓ Configurable worker count
✓ Per-part retry logic (3 attempts)
✓ Real-time result emission
✓ Thread-safe progress tracking
✓ NaN value handling

VERIFICATION
============

Syntax Check: PASSED
- edm_wizard/workers/threads.py: OK
- edm_wizard/workers/__init__.py: OK

Python Compilation: SUCCESSFUL
- Both files compile without errors
- Module is importable
- All classes are instantiable

Code Organization: EXCELLENT
- Clear separation of concerns
- Proper docstring formatting
- Consistent code style
- Well-organized imports

